rules_version = '2';

// Firebase Storage Security Rules
service firebase.storage {
  match /b/{bucket}/o {
    // Egzersiz videoları için kurallar
    match /exercise_videos/{exerciseId}/{videoFile} {
      // Sadece kimlik doğrulaması yapmış kullanıcılar okuyabilir
      allow read: if request.auth != null;
      
      // Sadece kimlik doğrulaması yapmış kullanıcılar yükleyebilir
      allow write: if request.auth != null
        && request.resource.size < 100 * 1024 * 1024 // 100MB limit
        && request.resource.contentType.matches('video/.*')
        && request.resource.metadata['exerciseId'] == exerciseId;
      
      // Sadece kimlik doğrulaması yapmış kullanıcılar silebilir
      allow delete: if request.auth != null;
    }
    
    // Diğer dosyalar için varsayılan kurallar
    match /{allPaths=**} {
      // Kimlik doğrulaması yapmış kullanıcılar okuyabilir
      allow read: if request.auth != null;
      
      // Kimlik doğrulaması yapmış kullanıcılar yazabilir
      allow write: if request.auth != null;
      
      // Kimlik doğrulaması yapmış kullanıcılar silebilir
      allow delete: if request.auth != null;
    }
  }
}
